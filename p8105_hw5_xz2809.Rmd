---
title: "p8105_hw5_xz2809"
author: "Coco"
date: "11/1/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

#Problem 1
##load files 
Start with a dataframe containing all file names; the list.files function will help
```{r}
files_df = list.files(path = "./data") %>% 
  as.data.frame()
colnames(files_df) = "subject_id"
```

##bind data
Iterate over file names and read in data for each subject using purrr::map and saving the result as a new variable in the dataframe

```{r message = FALSE}
read_files = function(x){
    read_csv(paste0("./data/",x))
}

df = map(files_df[ ,1],read_files)

mydf = df[[1]]
for (i in 2:20) {
  mydf = rbind(mydf,df[[i]])
}
mydf <- cbind(files_df, mydf) 
```

##tidy
Tidy the result; manipulate file names to include control arm and subject ID, make sure weekly observations are “tidy”, and do any other tidying that’s necessary

```{r}
mydf = mydf %>% 
  gather(key = week, value = value, week_1:week_8) %>% 
  mutate(week = str_replace(week,"week_",""),
         subject_id = str_replace(subject_id,".csv",""),
         overall_id = factor(subject_id)) %>% 
  separate(subject_id, into = c("arms", "id"),sep = "_") %>% 
  mutate(arms = str_replace(arms,"con","control"),
         arms = str_replace(arms,"exp","experiment"))
```
Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.

```{r}
mydf %>% 
  ggplot(aes(x = as.numeric(week), y=as.numeric(value)))+
  facet_grid(~ as.factor(arms)) + 
  viridis::scale_fill_viridis(discrete = TRUE)+
  geom_line(aes(color = id))+
  theme(legend.position = "bottom")+
  labs(
    x = "week",
    y = "value"
  )+
  ggtitle("Observations on each subject over time")
```




